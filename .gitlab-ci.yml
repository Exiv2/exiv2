.build_template: &distro_build
  script:
    - export CMAKE_OPTIONS="-DCMAKE_BUILD_TYPE=Release -DEXIV2_ENABLE_VIDEO=ON -DEXIV2_ENABLE_WEBREADY=ON -DEXIV2_BUILD_UNIT_TESTS=ON"
    - export CC=gcc
    - export CXX=g++
    - mkdir build && cd build && cmake .. && make -j $(nproc)
  artifacts:
    paths:
      - build/

.test_template: &distro_test
  script:
    - cd build && make tests

stages:
  - build
  - test

fedora_build:
  image: fedora:latest
  stage: build
  before_script:
    - dnf -y install --refresh gcc-c++ cmake expat-devel zlib-devel make libssh-devel curl-devel
  <<: *distro_build

fedora_test:
  image: fedora:latest
  stage: test
  before_script:
    - dnf -y install --refresh python3 cmake gcc-c++ cmake expat-devel zlib-devel make libssh-devel curl-devel which dos2unix
  <<: *distro_test

debian_build:
  image: debian:9
  stage: build
  before_script:
    - apt-get update
    - apt-get install -y cmake g++ libexpat1-dev zlib1g-dev make libssh-dev libcurl4-openssl-dev
  <<: *distro_build
